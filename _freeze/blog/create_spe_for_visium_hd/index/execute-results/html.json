{
  "hash": "7da416f87175a92a163d6dfb7ecce152",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Create R/Bioc Object for Visium HD\"\nauthor: \"Boyi Guo\"\ndate: \"2024-04-10\"\n# bibliography: references.bib\ncategories: [SRT, programming, Visium, Visium HD]\ndraft: TRUE\n---\n\n\nData is downloaded form 10x website via https://www.10xgenomics.com/datasets/visium-hd-cytassist-gene-expression-libraries-of-mouse-brain-he.\n\n\n## File structure\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfs::dir_tree(\"~/Visium_HD_Mouse_Brain/\",  recurse = FALSE)\n```\n:::\n\n```\n├── Visium_HD_Mouse_Brain_cloupe_008um.cloupe\n├── Visium_HD_Mouse_Brain_feature_slice.h5\n├── Visium_HD_Mouse_Brain_metrics_summary.csv\n├── Visium_HD_Mouse_Brain_molecule_info.h5\n├── Visium_HD_Mouse_Brain_spatial.tar.gz\n├── Visium_HD_Mouse_Brain_square_002um_outputs.tar.gz\n├── Visium_HD_Mouse_Brain_square_008um_outputs.tar.gz\n├── Visium_HD_Mouse_Brain_square_016um_outputs.tar.gz\n└── Visium_HD_Mouse_Brain_web_summary.html\n```\n\n\nCompare to the space ranger output of Visium dataset.\n\n::: {.cell}\n\n```{.r .cell-code}\nfs::dir_tree(\"~/GitHub/spatialDLPFC_SCZ/processed-data/spaceranger/V12D07-334_A1/\")\n```\n:::\n\n```\n> tree -L 1 .\n.\n├── analysis\n├── cloupe.cloupe\n├── deconvolution\n├── filtered_feature_bc_matrix\n├── filtered_feature_bc_matrix.h5\n├── metrics_summary.csv\n├── molecule_info.h5\n├── possorted_genome_bam.bam\n├── possorted_genome_bam.bam.bai\n├── raw_feature_bc_matrix\n├── raw_feature_bc_matrix.h5\n├── spatial\n└── web_summary.html\n```\n\nCompare to Visium space ranger, the basic files have some change.\n* new h5 file - [*feature_slice.h5](Feature Slice H5)\n\n\n## Create R/Bioc SpatialExperiment object\n\n### Rename files\nTo make things easier, the first thing I do is to remove the arbitrary prefix `Visium_HD_Mouse_Brain_` of the downloaded files.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nsetwd(\"~/Visium_HD_Mouse_Brain/\")\n\nfile.rename(\n  from = list.files(\"~/Visium_HD_Mouse_Brain/\", pattern = \"Visium_HD_Mouse_Brain\"),\n  to = str_remove(\n    list.files(\"~/Visium_HD_Mouse_Brain/\", pattern = \"Visium_HD_Mouse_Brain\"),\n    pattern = \"Visium_HD_Mouse_Brain_\"\n  )\n)\n\nfs::dir_tree(\".\")\n```\n:::\n\n```\n.\n├── cloupe_008um.cloupe\n├── feature_slice.h5\n├── metrics_summary.csv\n├── molecule_info.h5\n├── spatial.tar.gz\n├── square_002um_outputs.tar.gz\n├── square_008um_outputs.tar.gz\n├── square_016um_outputs.tar.gz\n└── web_summary.html\n```\n\n## Decompress output\n\n`spatial.tar.gz` and one of `square_0**um_outputs.tar.gz` `(we used 008um_output as an example)` need to be decompressed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuntar(\"spatial.tar.gz\")  \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in untar(\"spatial.tar.gz\"): '/usr/bin/tar -xf 'spatial.tar.gz''\nreturned error code 1\n```\n\n\n:::\n\n```{.r .cell-code}\nuntar(\"square_008um_outputs.tar.gz\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in untar(\"square_008um_outputs.tar.gz\"): '/usr/bin/tar -xf\n'square_008um_outputs.tar.gz'' returned error code 1\n```\n\n\n:::\n\n```{.r .cell-code}\nfs::dir_tree(\".\", recurse = 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n.\n├── index.qmd\n└── index.rmarkdown\n```\n\n\n:::\n:::\n\n```\n.\n├── cloupe_008um.cloupe\n├── feature_slice.h5\n├── metrics_summary.csv\n├── molecule_info.h5\n├── spatial\n│   ├── aligned_fiducials.jpg\n│   ├── aligned_tissue_image.jpg\n│   ├── cytassist_image.tiff\n│   ├── detected_tissue_image.jpg\n│   ├── tissue_hires_image.png\n│   └── tissue_lowres_image.png\n├── spatial.tar.gz\n├── square_002um_outputs.tar.gz\n├── square_008um\n│   ├── analysis\n│   ├── cloupe.cloupe\n│   ├── filtered_feature_bc_matrix\n│   ├── filtered_feature_bc_matrix.h5\n│   ├── raw_feature_bc_matrix\n│   ├── raw_feature_bc_matrix.h5\n│   └── spatial\n├── square_008um_outputs.tar.gz\n├── square_016um_outputs.tar.gz\n└── web_summary.html\n```\n\nWhen looking at the content in the `spatial` folder, there are images because using cytassist.\nIn addition, `tissue_positions.parquet` instead of `tissue_position.csv`. However, this seems to be robust in `VisiumIO`.\n\n\n### Create SpatialExperiment object with `VisiumIO`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\nlibrary(VisiumIO)             # VisiumIO doesn't depend on SpatialExperiment\nlibrary(SpatialExperiment)\n\n\n\nspe <- SpatialExperiment::read10xVisium(\n  samples = \"~/Visium_HD_Mouse_Brain/\",\n  type = \"HDF5\",\n  data = \"filter\"\n)\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}